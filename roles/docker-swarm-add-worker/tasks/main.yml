---
- name: check if swarm has already been initialized
  shell: docker node ls
  register: swarm_status
  ignore_errors: true

- name: add workers to the swarm
  shell: docker swarm join --token {{ hostvars[groups['managers'][0]]['worker_token']['stdout'] }} {{ hostvars[groups['managers'][0]]['ansible_default_ipv4']['address'] }}:2377
  when: swarm_status.rc != 0
